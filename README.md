# ITTV


## Содержание

1. [Описание](#описание)
2. [Конфигурация](#конфигурация)
   1. [Configuration](#configuration)
   2. [Cache](#cache)
   4. [Games](#games)
   5. [ScheduleImages](#scheduleimages)
   6. [Videos](#videos)
      + Videos\Background
   7. [Logs](#logs)
3. [Кража фокуса экрана другими приложениями](#кража-фокуса-экрана-другими-приложениями)
4. [Deploy](#deploy)
5. [License](#license)
   

## Описание

ПРИЛОЖЕНИЕ ЗАКРЫВАЕТСЯ ТОЛЬКО ЧЕРЕЗ ДИСПЕТЧЕР ЗАДАЧ !!!

Альтернативные методы (Alt+F4 и тп.) работают только в случае, если в настройках стоит режим Администратора.

## Конфигурация

### Configuration

В главной директории располагается файл настроек `configuration.json`, который имеет следующую структуру:

``` jsonc
{
  "Settings": {
    "isAdminMode": true, // включения режима админского управления, включающего в себя: возможность выключения через alt+F4 и работу мышки
    "needCheckTime": true, // включение режима ночной работы приложения (ночью работает герб МИРЭА, вместо видео)
    "startWorkTime": "08:00:00", // время начала работы сервиса, HH:mm:ss
    "endWorkTime": "22:00:00", // время завершения работы сервиса, переход в спящий режим, HH:mm:ss
    "inactiveModeTime" : "00:01:00", // допустимая длительность бездействия, HH:mm:ss
    "cacheUpdateInterval": "00:20:00", // установка частоты обновления кэшируемых данных, HH:mm:ss
    "videoVolume": 1, // установка уровня громкости всех видеозаписей в приложении. Значение: от 0 до 1
    "backgroundVideoOrder": [], // установка плейлиста, в последовательности которого будут воспроизводиться ролики
    "eggVideoCommands": []
  }
}
```

### Cache

При взаимодействии с сервером все данные (расписание групп, новости) кэшируются на период, заданный в конфигурации `cacheUpdateInterval`.

Пример заполнения конфигурации при периоде кэширования 30 минут:

``` jsonc
{
  "Settings": {
    "isAdminMode": false, 
    "needCheckTime": false, 
    "startWorkTime": "00:00:00", 
    "endWorkTime": "00:00:00", 
    "inactiveModeTime" : "00:00:00", 
    "cacheUpdateInterval": "00:30:00", 
    "videoVolume": 0, 
    "backgroundVideoOrder": [], 
    "eggVideoCommands": []
  }
}
```

Проверка актуальности кэша осуществляется при прямом обращении к нему, за исключением кэша новостей. Последний обновляется постоянно, с частотой, указаной в `cacheUpdateInterval`.

### Games

В директории `Games` находятся игры которые можно добавлять. Единственное требование - создать внутри директории Games директорию, название которой будет являться названием панели в самом приложении. Внутри директории с названием игры должен лежать собранный проект с исполняемым файлом игры (.exe).

### ScheduleImages

В `Images\ScheduleImages` необходимо разместить расписание в поддерживаемом формате изображения (для получение из excel файла изображение можно воспользоваться любым онлайн конвертером). 

Поддерживаемые форматы изображения : `.png`, `.jpg`, `.jpeg`.

Расписание для курсов бакалавриата размещается в директории `Images\ScheduleImages\Bachelor`:

   - 1.* - расписание первого курса
   - 2.* - расписание второго курса
   - 3.* - расписание третьего курса
   - 4.* - расписание четвертого курса 

Расписание для курсов бакалавриата размещается в директории `Images\ScheduleImages\Master`:

   - 1.* - расписание первого курса
   - 2.* - расписание второго курса

Пример полного названия файла - `1.png`.

### Videos

Поддерживаемые форматы видеофайлов: `ogg`, `mov`, `mp4`.

Для добавления видеоролика в раздел `Видео` необходимо разместить видео в поддерживаемом формате в директории `Videos`.

#### Videos\Background

Чтобы добавить видео для фонового проигрывания (режим бездействия), нужно поместить видеоролики в директорию `Videos\Background` и прописать название видеоролика в файле `configuration.json`.

Пример заполнения конфигурации при названии ролика `1.mp4`:
``` jsonc
{
  "Settings": {
    "isAdminMode": false, 
    "needCheckTime": false, 
    "startWorkTime": "00:00:00", 
    "endWorkTime": "00:00:00", 
    "inactiveModeTime" : "00:00:00", 
    "cacheUpdateInterval": "00:00:00", 
    "videoVolume": 0, 
    "backgroundVideoOrder": [
       "1.mp4"
    ], 
    "eggVideoCommands": []
  }
}
```


### Logs

Логи приложения пишутся в файл `logs.txt`, располагаемый в корневом каталоге.

## Кража фокуса экрана другими приложениями

Для модуля KinectControls необходимо наличие фокуса на экране. При отсутствии фокуса на нем вы не сможете взаимодействовать с решением и оно просто не будет реагировать на ввод.

В системе Windows очень часть сторонние приложения запускаемые по таймеру или любому другому тригеру производят эффект, называемый "Stilling Focus". Как описано выше при открытии любого окна поверх приложения оно будет не активно

Для решения данной проблемы мы рекомендуем использовать решение [Turbotop](https://www.savardsoftware.com/turbotop/). Оно достаточно легковесное и позволит вам выбрать в нем окно приложения как активное, что защитит его от кражи фокуса и оно всегда будет воспроизводиться OnTop.

## Deploy

Для развёртывания приложения необходимо предустановить следующие компоненты:

- [Microsoft Net Framework 4.8 Runtime](https://dotnet.microsoft.com/en-us/download/dotnet-framework/net48)
- [Kinect for Windows SDK 2.0](https://www.microsoft.com/en-us/download/details.aspx?id=44561)
- [Kinect for Windows Runtime 2.2](https://www.microsoft.com/en-us/download/details.aspx?id=100067)


Детальную информацию можно найти в [последнем релизе](https://github.com/RTUITLab/KinectV2TVInteraction/releases/latest)

## License
- [Apache-2.0 License](https://github.com/RTUITLab/ITTV/blob/master/LICENSE)
